<HTML
><HEAD
><TITLE
>Ejemplos de video</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.49"><LINK
REL="HOME"
TITLE="SDL Library Documentation"
HREF="book1.html" tppabs="http://sdl.euskal-linux.org/guia/book1.html"><LINK
REL="UP"
TITLE="Ejemplos"
HREF="guideexamples.html" tppabs="http://sdl.euskal-linux.org/guia/guideexamples.html"><LINK
REL="PREVIOUS"
TITLE="Ejemplos"
HREF="guideexamples.html" tppabs="http://sdl.euskal-linux.org/guia/guideexamples.html"><LINK
REL="NEXT"
TITLE="Ejemplos de eventos"
HREF="x278.html" tppabs="http://sdl.euskal-linux.org/guia/x278.html"> <link rel="STYLESHEET" type="text/css" href="../styles.css" tppabs="http://sdl.euskal-linux.org/styles.css">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="description" content="Euskal Linux ORG">
<meta name="keywords" content="Linux,Linux Gazette,issue,articulos,sistemas operativos,php,pocketpc,administración,redes,bases de datos,GNU,RedHat,Debian,FDL,OpenContent,penguin,Free Software,FSF,Postgresql,ext2,reiserfs,Linus Torvalds,Alan Cox,KDE,GNOME,WindowMaker,AfterStep,Enlightment,BlackBox,Sawfish,Samba,Lyx,Tux">
<meta name="language" content="Spanish">
<meta name="copyright" content="Euskal Linux ORG">
<meta name="robots" content="ALL">
<meta name="reply-to" content="webmaster@euskal-linux.org">
<meta http-equiv="Content-Language" content="ES-ES">
<link rel="icon" href="../../error.euskal-linux.org/pagina_no_encontrada.html" tppabs="http://sdl.euskal-linux.org/guia/favicon.ico">
 </HEAD
><BODY
CLASS="SECT1"
><table cellspacing="0" cellpadding="0" width="100%" border="0">
  <tr bgcolor="#E7E7E7">
    <td colspan=2><img src="../graficos/pixel.png" tppabs="http://sdl.euskal-linux.org/graficos/pixel.png" width="1" height="1" alt=""></td>
  </tr>

  <tr valign="middle" bgcolor="#C0C0C0">
    <td>
      <font color=#000000>
      &nbsp;&middot;&nbsp;<a class="osdn" href="javascript:if(confirm('http://www.euskal-linux.org/home.htm  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.euskal-linux.org/home.htm'" tppabs="http://www.euskal-linux.org/home.htm" target="_top">Euskal Linux ORG</a>
      &nbsp;&middot;&nbsp;<a class="osdn" href="javascript:if(confirm('http://www.hegali.org/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.hegali.org/'" tppabs="http://www.hegali.org/" target="_top">Hegali ORG</a>
      &nbsp;&middot;&nbsp;<a class="osdn" href="javascript:if(confirm('http://gazette.euskal-linux.org/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://gazette.euskal-linux.org/'" tppabs="http://gazette.euskal-linux.org/" target="_top">Linux Gazette</a>
      &nbsp;&middot;&nbsp;<a class="osdn" href="javascript:if(confirm('http://www.euskal-gnu.org/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.euskal-gnu.org/'" tppabs="http://www.euskal-gnu.org/">Euskara</a>
      &nbsp;&middot;&nbsp;
      </font>
    </td>

    <td align="right">
      <font color=#000000>
      &nbsp;&middot;&nbsp;
      <a class="osdn" href="javascript:if(confirm('http://sdl.euskal-linux.org/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://sdl.euskal-linux.org/'" tppabs="http://sdl.euskal-linux.org/">HOME</a>&nbsp;&middot;&nbsp;
      </font>
    </td>
  </tr>

  <tr valign="middle" bgcolor="#6F6F6F">
    <td colspan=2><img src="../graficos/pixel.png" tppabs="http://sdl.euskal-linux.org/graficos/pixel.png" width="1" height="1" alt=""></td>
  </tr>
  <tr bgcolor="#E7E7E7">
    <td colspan=2><img src="../graficos/pixel.png" tppabs="http://sdl.euskal-linux.org/graficos/pixel.png" width="1" height="1" alt=""></td>
  </tr>
</table>
<BR><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>SDL Library Documentation</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="guideexamples.html" tppabs="http://sdl.euskal-linux.org/guia/guideexamples.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 4. Ejemplos</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x278.html" tppabs="http://sdl.euskal-linux.org/guia/x278.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN245"
>Ejemplos de video</A
></H1
><P
></P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN248"
>Inicializar la pantalla (display) de video</A
></H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>    SDL_Surface *screen;

    /* Inicializar la librería SDL */
    if( SDL_Init(SDL_INIT_VIDEO) &#60; 0 ) {
        fprintf(stderr,
                "Imposible inicializar SDL: %s\n", SDL_GetError());
        exit(1);
    }

    /* Limpiar al salir */
    atexit(SDL_Quit);

    /* Inicializar la pantalla (display) a 640x480 8-bit palettized */
    screen = SDL_SetVideoMode(640, 480, 8, SDL_SWSURFACE);
    if ( screen == NULL ) {
        fprintf(stderr, "Imposible iniciar modo de video 640x480x8: %s\n",
                        SDL_GetError());
        exit(1);
    }</PRE
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN252"
>Inicializar el mejor modo de video</A
></H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>    /* Tener como preferencia 8-bit, pero aceptar cualquier profundidad de bits */
    screen = SDL_SetVideoMode(640, 480, 8, SDL_SWSURFACE|SDL_ANYFORMAT);
    if ( screen == NULL ) {
        fprintf(stderr, "Imposible iniciar modo de video 640x480x8: %s\n",
                        SDL_GetError());
        exit(1);
    }
    printf("Inicializado 640x480 a %d bits-por-pixel\n",
           screen-&#62;format-&#62;BitsPerPixel);</PRE
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN256"
>Cargar y mostrar un fichero BMP</A
></H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>    SDL_Surface *image;
    SDL_Rect dest;
    int ncolors, i;
    SDL_Color *colors;

    /* Cargar el fichero BMP en una superficie (surface) */
    image = SDL_LoadBMP("sample.bmp");
    if ( image == NULL ) {
        fprintf(stderr, "Imposible cargar sample.bmp: %s\n",
                        SDL_GetError());
        return;
    }

    /* Set the display colors -- SDL_SetColors() only does something on
       palettized displays, but it doesn't hurt anything on HiColor or
       TrueColor displays.
       If the display colors have already been set, this step can be
       skipped, and the library will automatically map the image to
       the current display colors.
    */
    if ( image-&#62;format-&#62;palette ) {
        ncolors = image-&#62;format-&#62;palette-&#62;ncolors;
        colors  = (SDL_Color *)malloc(ncolors*sizeof(SDL_Color));
        memcpy(colors, image-&#62;format-&#62;palette-&#62;colors, ncolors);
    } 
    else {
        int r, g, b;

        /* Allocate 256 color palette */
        ncolors = 256;
        colors  = (SDL_Color *)malloc(ncolors*sizeof(SDL_Color));

        /* Set a 3,3,2 color cube */
        for ( r=0; r&#60;8; ++r ) {
            for ( g=0; g&#60;8; ++g ) {
                for ( b=0; b&#60;4; ++b ) {
                    i = ((r&#60;&#60;5)|(g&#60;&#60;2)|b);
                    colors[i].r = r&#60;&#60;5;
                    colors[i].g = g&#60;&#60;5;
                    colors[i].b = b&#60;&#60;6;
                }
            }
        }
        /* Note: A better way of allocating the palette might be
           to calculate the frequency of colors in the image
           and create a palette based on that information.
        */
    }
    /* Set colormap, try for all the colors, but don't worry about it */
    SDL_SetColors(screen, colors, 0, ncolors);
    free(colors);

    /* Blit onto the screen surface */
    dest.x = 0;
    dest.y = 0;
    dest.w = image-&#62;w;
    dest.h = image-&#62;h;
    SDL_BlitSurface(image, NULL, screen, &#38;dest);

    SDL_UpdateRects(screen, 1, &#38;dest);

    /* Free the allocated BMP surface */
    SDL_FreeSurface(image);
    return;</PRE
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN260"
>Dibujar directamente en al pantalla (display)</A
></H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>    /* Code to set a yellow pixel at the center of the screen */

    Sint32   X, Y;
    Uint32   pixel;
    Uint8   *bits, bpp;

    /* Map the color yellow to this display (R=0xFF, G=0xFF, B=0x00)
       Note:  If the display is palettized, you must set the palette first.
    */
    pixel = SDL_MapRGB(screen-&#62;format, 0xFF, 0xFF, 0x00);

    /* Calculate the framebuffer offset of the center of the screen */
    if ( SDL_MUSTLOCK(screen) ) {
        if ( SDL_LockSurface(screen) &#60; 0 )
            return;
    }
    bpp = screen-&#62;format-&#62;BytesPerPixel;
    X = screen-&#62;w/2;
    Y = screen-&#62;h/2;
    bits = ((Uint8 *)screen-&#62;pixels)+Y*screen-&#62;pitch+X*bpp;

    /* Poner un pixel */
    switch(bpp) {
        case 1:
            *((Uint8 *)(bits)) = (Uint8)pixel;
            break;
        case 2:
            *((Uint16 *)(bits)) = (Uint16)pixel;
            break;
        case 3: { /* Format/endian independent */
            Uint8 r, g, b;

            r = (pixel&#62;&#62;screen-&#62;format-&#62;Rshift)&#38;0xFF;
            g = (pixel&#62;&#62;screen-&#62;format-&#62;Gshift)&#38;0xFF;
            b = (pixel&#62;&#62;screen-&#62;format-&#62;Bshift)&#38;0xFF;
            *((bits)+screen-&#62;format-&#62;Rshift/8) = r; 
            *((bits)+screen-&#62;format-&#62;Gshift/8) = g;
            *((bits)+screen-&#62;format-&#62;Bshift/8) = b;
            }
            break;
        case 4:
            *((Uint32 *)(bits)) = (Uint32)pixel;
            break;
    }

    /* Actualizar la pantalla (display) */
    if ( SDL_MUSTLOCK(screen) ) {
        SDL_UnlockSurface(screen);
    }
    SDL_UpdateRect(screen, X, Y, 1, 1);

    return;</PRE
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN264"
>Fastest possible surface blit</A
></H2
><P
>There are three different ways you can draw an image to the screen: 
<P
></P
><TABLE
BORDER="0"
><TR
><TD
>1.Create a surface and use <A
HREF="sdlblitsurface.html" tppabs="http://sdl.euskal-linux.org/guia/sdlblitsurface.html"
><TT
CLASS="FUNCTION"
>SDL_BlitSurface</TT
></A
> to blit it to the screen</TD
></TR
><TR
><TD
>2.Create the video surface in system memory and call <A
HREF="sdlupdaterect.html" tppabs="http://sdl.euskal-linux.org/guia/sdlupdaterect.html"
><TT
CLASS="FUNCTION"
>SDL_UpdateRect</TT
></A
></TD
></TR
><TR
><TD
>3.Create the video surface in video memory and call <A
HREF="sdllocksurface.html" tppabs="http://sdl.euskal-linux.org/guia/sdllocksurface.html"
><TT
CLASS="FUNCTION"
>SDL_LockSurface</TT
></A
></TD
></TR
></TABLE
><P
></P
>
The best way to do this is to combine methods: 
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>#include &#60;stdio.h&#62;
#include &#60;stdlib.h&#62;
#include "SDL.h"
#include "SDL_timer.h"

void ComplainAndExit(void)
{
    fprintf(stderr, "Problema: %s\n", SDL_GetError());
    exit(1);
}

int main(int argc, char *argv[])
{
    SDL_PixelFormat fmt;
    SDL_Surface *screen, *locked;
    SDL_Surface *imagebmp, *image;
    SDL_Rect dstrect;
    int i;
    Uint8 *buffer;

    /* Initializar SDL */
    if ( SDL_Init(SDL_INIT_VIDEO) &#60; 0 ) {
        ComplainAndExit();
    }
    atexit(SDL_Quit);

    /* Cargar imagen BMP en una superficie (surface) */
    imagebmp = SDL_LoadBMP("image.bmp");
    if ( imagebmp == NULL ) {
        ComplainAndExit();
    }

    /* Iniciar el modo de video (640x480 con profundidad de pixeles nativa) */
    screen = SDL_SetVideoMode(640, 480, 0, SDL_HWSURFACE|SDL_FULLSCREEN);
    if ( screen == NULL ) {
        ComplainAndExit();
    }

    /* Set the video colormap */
    if ( imagebmp-&#62;format-&#62;palette != NULL ) {
        SDL_SetColors(screen,
                      imagebmp-&#62;format-&#62;palette-&#62;colors, 0,
                      imagebmp-&#62;format-&#62;palette-&#62;ncolors);
    }

    /* Convert the image to the video format (maps colors) */
    image = SDL_DisplayFormat(imagebmp);
    SDL_FreeSurface(imagebmp);
    if ( image == NULL ) {
        ComplainAndExit();
    }

    /* Draw bands of color on the raw surface */
    if ( SDL_MUSTLOCK(screen) ) {
        if ( SDL_LockSurface(screen) &#60; 0 )
            ComplainAndExit();
    }
    buffer=(Uint8 *)screen-&#62;pixels;
    for ( i=0; i&#60;screen-&#62;h; ++i ) {
        memset(buffer,(i*255)/screen-&#62;h,
               screen-&#62;w*screen-&#62;format-&#62;BytesPerPixel);
               buffer += screen-&#62;pitch;
    }
    if ( SDL_MUSTLOCK(screen) ) {
        SDL_UnlockSurface(screen);
    }

    /* Blit the image to the center of the screen */
    dstrect.x = (screen-&#62;w-image-&#62;w)/2;
    dstrect.y = (screen-&#62;h-image-&#62;h)/2;
    dstrect.w = image-&#62;w;
    dstrect.h = image-&#62;h;
    if ( SDL_BlitSurface(image, NULL, screen, &#38;dstrect) &#60; 0 ) {
        SDL_FreeSurface(image);
        ComplainAndExit();
    }
    SDL_FreeSurface(image);

    /* Actualizar la pantalla (screen) */
    SDL_UpdateRects(screen, 1, &#38;dstrect);

    SDL_Delay(5000);        /* Esperar 5 segundos */
    exit(0);
}</PRE
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="guideexamples.html" tppabs="http://sdl.euskal-linux.org/guia/guideexamples.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html" tppabs="http://sdl.euskal-linux.org/guia/book1.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x278.html" tppabs="http://sdl.euskal-linux.org/guia/x278.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Ejemplos</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="guideexamples.html" tppabs="http://sdl.euskal-linux.org/guia/guideexamples.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Ejemplos de eventos</TD
></TR
></TABLE
></DIV
>
<CENTER>
<HR>
 <A HREF="javascript:if(confirm('http://sdl.euskal-linux.org/banner/www.hegali.org/euro/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://sdl.euskal-linux.org/banner/www.hegali.org/euro/'" tppabs="http://sdl.euskal-linux.org/banner/www.hegali.org/euro/"><IMG SRC="../graficos/euro.png" tppabs="http://sdl.euskal-linux.org/graficos/euro.png" BORDER="0" ALT="Euro Calculadora"></A> &nbsp; &nbsp;
 <A HREF="javascript:if(confirm('http://sdl.euskal-linux.org/banner/www.debian.org  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://sdl.euskal-linux.org/banner/www.debian.org'" tppabs="http://sdl.euskal-linux.org/banner/www.debian.org"><IMG SRC="../graficos/powerdebian.png" tppabs="http://sdl.euskal-linux.org/graficos/powerdebian.png" BORDER="0" ALT="Powered by Debian"></A> &nbsp; &nbsp;
 <A HREF="javascript:if(confirm('http://sdl.euskal-linux.org/banner/www.hegali.org  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://sdl.euskal-linux.org/banner/www.hegali.org'" tppabs="http://sdl.euskal-linux.org/banner/www.hegali.org"><IMG SRC="../graficos/banner_hegali.png" tppabs="http://sdl.euskal-linux.org/graficos/banner_hegali.png" BORDER="0" ALT="Hegali ORG"></A> &nbsp; &nbsp;
 <A HREF="javascript:if(confirm('http://sdl.euskal-linux.org/banner/www.tallerdice.com  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://sdl.euskal-linux.org/banner/www.tallerdice.com'" tppabs="http://sdl.euskal-linux.org/banner/www.tallerdice.com"><IMG SRC="../graficos/banner_dice.png" tppabs="http://sdl.euskal-linux.org/graficos/banner_dice.png" BORDER="0" ALT="Taller D.I.C.E."></A> &nbsp; &nbsp;
 <A HREF="javascript:if(confirm('http://sdl.euskal-linux.org/banner/www.euskal-linux.org  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://sdl.euskal-linux.org/banner/www.euskal-linux.org'" tppabs="http://sdl.euskal-linux.org/banner/www.euskal-linux.org"><IMG SRC="../graficos/banner_el.png" tppabs="http://sdl.euskal-linux.org/graficos/banner_el.png" BORDER="0" ALT="Euskal Linux ORG"></A> &nbsp; &nbsp;
 <A HREF="javascript:if(confirm('http://sdl.euskal-linux.org/banner/www.apache.org  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://sdl.euskal-linux.org/banner/www.apache.org'" tppabs="http://sdl.euskal-linux.org/banner/www.apache.org"><IMG SRC="../graficos/apache.png" tppabs="http://sdl.euskal-linux.org/graficos/apache.png" BORDER="0" ALT="Powered by Apache"></A> &nbsp; &nbsp;
 <A HREF="javascript:if(confirm('http://sdl.euskal-linux.org/banner/libros.euskal-linux.org  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://sdl.euskal-linux.org/banner/libros.euskal-linux.org'" tppabs="http://sdl.euskal-linux.org/banner/libros.euskal-linux.org"><IMG SRC="../graficos/banner_libro.png" tppabs="http://sdl.euskal-linux.org/graficos/banner_libro.png" BORDER="0" ALT="Base de Datos de libros"></A> &nbsp; &nbsp;
<HR><BR>
&copy 1995, 2002 &nbsp; Euskal Linux ORG<BR>
&copy 2000, 2002 &nbsp; Hegali ORG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <BR><BR>
</CENTER>

 </BODY
></HTML
>